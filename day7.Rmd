---
title: "day3"
date: "2024-12-05"
---

```{r library}
library(stringr)
library(readr)
library(sjmisc)
library(dplyr)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r import}
# Set the file path
file_path <- "day7_input.txt"
# Read the file using readLines()
file_content <- readLines(file_path)

# Set the file path
file_path_test <- "day7_test_input.txt"
# Read the file using readLines()
file_content_test <- readLines(file_path_test)


```

```{r functions}
#Part 1
input <- file_content
math_ops <- c("+","*")

option_set <- function(input){
    values <- input
    
    if (length(input) == 2){
      df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]))
      df_duplicate <- rbind(df, df[rep(1, 1), ])
      
      operators <- expand.grid(math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
    } else if (length(input) == 3){
      df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]), Val3 = as.numeric(values[3]))
      df_duplicate <- rbind(df, df[rep(1, 3), ])
      
      operators <- expand.grid(math_ops,math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
      comb_df <- comb_df %>% relocate(Var2, .after=Val2)
    } else if (length(input) == 4){
      df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]), 
                       Val3 = as.numeric(values[3]), Val4 = as.numeric(values[4]))
      df_duplicate <- rbind(df, df[rep(1, 7), ])
      
      operators <- expand.grid(math_ops,math_ops,math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
      comb_df <- comb_df %>% relocate(Var2, .after=Val2)
      comb_df <- comb_df %>% relocate(Var3, .after=Val3)
    } else if (length(input) == 5){
      df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]), 
                       Val3 = as.numeric(values[3]), Val4 = as.numeric(values[4]),
                       Val5 = as.numeric(values[5]))
      df_duplicate <- rbind(df, df[rep(1, 15), ])
      
      operators <- expand.grid(math_ops,math_ops,math_ops,math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
      comb_df <- comb_df %>% relocate(Var2, .after=Val2)
      comb_df <- comb_df %>% relocate(Var3, .after=Val3)
      comb_df <- comb_df %>% relocate(Var4, .after=Val4)
    } else if (length(input) == 6){
      df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]), 
                       Val3 = as.numeric(values[3]), Val4 = as.numeric(values[4]),
                       Val5 = as.numeric(values[5]), Val6 = as.numeric(values[6]))
      df_duplicate <- rbind(df, df[rep(1, 31), ])
      
      operators <- expand.grid(math_ops,math_ops,math_ops,math_ops,math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
      comb_df <- comb_df %>% relocate(Var2, .after=Val2)
      comb_df <- comb_df %>% relocate(Var3, .after=Val3)
      comb_df <- comb_df %>% relocate(Var4, .after=Val4)
      comb_df <- comb_df %>% relocate(Var5, .after=Val5)
    } else if (length(input) == 7){
      df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]), 
                       Val3 = as.numeric(values[3]), Val4 = as.numeric(values[4]),
                       Val5 = as.numeric(values[5]), Val6 = as.numeric(values[6]),
                       Val7 = as.numeric(values[7]))
      df_duplicate <- rbind(df, df[rep(1, 63), ])
      
      operators <- expand.grid(math_ops,math_ops,math_ops,math_ops,math_ops,math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
      comb_df <- comb_df %>% relocate(Var2, .after=Val2)
      comb_df <- comb_df %>% relocate(Var3, .after=Val3)
      comb_df <- comb_df %>% relocate(Var4, .after=Val4)
      comb_df <- comb_df %>% relocate(Var5, .after=Val5)
      comb_df <- comb_df %>% relocate(Var6, .after=Val6)
    } else if (length(input) == 8){
      df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]), 
                       Val3 = as.numeric(values[3]), Val4 = as.numeric(values[4]),
                       Val5 = as.numeric(values[5]), Val6 = as.numeric(values[6]),
                       Val7 = as.numeric(values[7]), Val8 = as.numeric(values[8]))
      df_duplicate <- rbind(df, df[rep(1, 127), ])
      
      operators <- expand.grid(math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
      comb_df <- comb_df %>% relocate(Var2, .after=Val2)
      comb_df <- comb_df %>% relocate(Var3, .after=Val3)
      comb_df <- comb_df %>% relocate(Var4, .after=Val4)
      comb_df <- comb_df %>% relocate(Var5, .after=Val5)
      comb_df <- comb_df %>% relocate(Var6, .after=Val6)
      comb_df <- comb_df %>% relocate(Var7, .after=Val7)
    } else if (length(input) == 9){
       df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]), 
                       Val3 = as.numeric(values[3]), Val4 = as.numeric(values[4]),
                       Val5 = as.numeric(values[5]), Val6 = as.numeric(values[6]),
                       Val7 = as.numeric(values[7]), Val8 = as.numeric(values[8]),
                       Val9 = as.numeric(values[9]))
      df_duplicate <- rbind(df, df[rep(1, 255), ])
      
      operators <- expand.grid(math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
      comb_df <- comb_df %>% relocate(Var2, .after=Val2)
      comb_df <- comb_df %>% relocate(Var3, .after=Val3)
      comb_df <- comb_df %>% relocate(Var4, .after=Val4)
      comb_df <- comb_df %>% relocate(Var5, .after=Val5)
      comb_df <- comb_df %>% relocate(Var6, .after=Val6)
      comb_df <- comb_df %>% relocate(Var7, .after=Val7)
      comb_df <- comb_df %>% relocate(Var8, .after=Val8)
    } else if (length(input) == 10){
      df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]), 
                       Val3 = as.numeric(values[3]), Val4 = as.numeric(values[4]),
                       Val5 = as.numeric(values[5]), Val6 = as.numeric(values[6]),
                       Val7 = as.numeric(values[7]), Val8 = as.numeric(values[8]),
                       Val9 = as.numeric(values[9]), Val10 = as.numeric(values[10]))
      df_duplicate <- rbind(df, df[rep(1, 511), ])
      
      operators <- expand.grid(math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
      comb_df <- comb_df %>% relocate(Var2, .after=Val2)
      comb_df <- comb_df %>% relocate(Var3, .after=Val3)
      comb_df <- comb_df %>% relocate(Var4, .after=Val4)
      comb_df <- comb_df %>% relocate(Var5, .after=Val5)
      comb_df <- comb_df %>% relocate(Var6, .after=Val6)
      comb_df <- comb_df %>% relocate(Var7, .after=Val7)
      comb_df <- comb_df %>% relocate(Var8, .after=Val8)
      comb_df <- comb_df %>% relocate(Var9, .after=Val9)
    } else if (length(input) == 11){
       df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]), 
                       Val3 = as.numeric(values[3]), Val4 = as.numeric(values[4]),
                       Val5 = as.numeric(values[5]), Val6 = as.numeric(values[6]),
                       Val7 = as.numeric(values[7]), Val8 = as.numeric(values[8]),
                       Val9 = as.numeric(values[9]), Val10 = as.numeric(values[10]),
                       Val11 = as.numeric(values[11]))
      df_duplicate <- rbind(df, df[rep(1, 1023), ])
      
      operators <- expand.grid(math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
      comb_df <- comb_df %>% relocate(Var2, .after=Val2)
      comb_df <- comb_df %>% relocate(Var3, .after=Val3)
      comb_df <- comb_df %>% relocate(Var4, .after=Val4)
      comb_df <- comb_df %>% relocate(Var5, .after=Val5)
      comb_df <- comb_df %>% relocate(Var6, .after=Val6)
      comb_df <- comb_df %>% relocate(Var7, .after=Val7)
      comb_df <- comb_df %>% relocate(Var8, .after=Val8)
      comb_df <- comb_df %>% relocate(Var9, .after=Val9)
      comb_df <- comb_df %>% relocate(Var10, .after=Val10)
      } else if (length(input) == 12){
       df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]), 
                       Val3 = as.numeric(values[3]), Val4 = as.numeric(values[4]),
                       Val5 = as.numeric(values[5]), Val6 = as.numeric(values[6]),
                       Val7 = as.numeric(values[7]), Val8 = as.numeric(values[8]),
                       Val9 = as.numeric(values[9]), Val10 = as.numeric(values[10]),
                       Val11 = as.numeric(values[11]), Val12 = as.numeric(values[12]))
      df_duplicate <- rbind(df, df[rep(1, 2047), ])
      
      operators <- expand.grid(math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops,math_ops, math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
      comb_df <- comb_df %>% relocate(Var2, .after=Val2)
      comb_df <- comb_df %>% relocate(Var3, .after=Val3)
      comb_df <- comb_df %>% relocate(Var4, .after=Val4)
      comb_df <- comb_df %>% relocate(Var5, .after=Val5)
      comb_df <- comb_df %>% relocate(Var6, .after=Val6)
      comb_df <- comb_df %>% relocate(Var7, .after=Val7)
      comb_df <- comb_df %>% relocate(Var8, .after=Val8)
      comb_df <- comb_df %>% relocate(Var9, .after=Val9)
      comb_df <- comb_df %>% relocate(Var10, .after=Val10)
      comb_df <- comb_df %>% relocate(Var11, .after=Val11)
      } else if (length(input) == 13){
       df <- data.frame(Val1 = as.numeric(values[1]), Val2 = as.numeric(values[2]), 
                       Val3 = as.numeric(values[3]), Val4 = as.numeric(values[4]),
                       Val5 = as.numeric(values[5]), Val6 = as.numeric(values[6]),
                       Val7 = as.numeric(values[7]), Val8 = as.numeric(values[8]),
                       Val9 = as.numeric(values[9]), Val10 = as.numeric(values[10]),
                       Val11 = as.numeric(values[11]), Val12 = as.numeric(values[12]),
                       Val13 = as.numeric(values[13]))
      df_duplicate <- rbind(df, df[rep(1, 4095), ])
      
      operators <- expand.grid(math_ops,math_ops,math_ops,math_ops,math_ops,
                               math_ops,math_ops,math_ops,math_ops,math_ops, math_ops,math_ops)
      comb_df <- cbind(df_duplicate, operators)
      
      comb_df <- comb_df %>% relocate(Var1, .after=Val1)
      comb_df <- comb_df %>% relocate(Var2, .after=Val2)
      comb_df <- comb_df %>% relocate(Var3, .after=Val3)
      comb_df <- comb_df %>% relocate(Var4, .after=Val4)
      comb_df <- comb_df %>% relocate(Var5, .after=Val5)
      comb_df <- comb_df %>% relocate(Var6, .after=Val6)
      comb_df <- comb_df %>% relocate(Var7, .after=Val7)
      comb_df <- comb_df %>% relocate(Var8, .after=Val8)
      comb_df <- comb_df %>% relocate(Var9, .after=Val9)
      comb_df <- comb_df %>% relocate(Var10, .after=Val10)
      comb_df <- comb_df %>% relocate(Var11, .after=Val11)
      comb_df <- comb_df %>% relocate(Var12, .after=Val12)
      } else if (length(input) == 14){
        print("need more")
        break
        }
  
    return(comb_df)
}


start.time <- Sys.time()

count <- 0 
result <- 0 

for (i in 1:length(input)){
  tot_i <- str_match_all(input[i],"\\s*(.*?)\\s*:")
  tot_i <- as.numeric(tot_i[[1]][2])
  out_i <- str_split(input[i]," ")
  
  values <- out_i[[1]][2:length(out_i[[1]])]
 
  comb_df <- option_set(values)

  tot_ck <- vector(mode = "list", length = length(comb_df$Val1))
  
  for (j in 1:length(tot_ck)){
    tot_ck[[j]] <- as.numeric(comb_df[j,1])
    
    for (k in seq(2, (length(comb_df[1,])-1), by = 2)){
      if (comb_df[j,k] == "+"){
        tot_ck[[j]] <- tot_ck[[j]] + as.numeric(comb_df[j,k+1])
      } else if (comb_df[j,k] == "*"){
        tot_ck[[j]] <- tot_ck[[j]] * as.numeric(comb_df[j,k+1])
      }
    }
  
   if (tot_ck[[j]] == tot_i){
     count <- count + 1
     result <- result + tot_i
     break
   } 
  }
}
  
pt1_solution <- result
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken
```

```{r main}

# Part 2
obs_input_map_extract <- str_extract_all(input_map, boundary("character"))
x_ids <- vector(mode = "list", length = length(input_map))

for (i in 1:length(input_map)){
    input_map_row <- str_match_all(input_map_extract[[i]],"X")
    x_ids[[i]] <- which(lengths(input_map_row)!=0)
    
}

alt_input_maps <- vector(mode = "list", length = 4967)
count <- 0
direction <- c("\\^","v","\\>","\\<")
dist_pos <- 1

for (i in 1:length(x_ids)){
  for (j in 1:length(x_ids[[i]])){
    
    if (!identical(x_ids[[i]], integer(0))){
      temp_map <- file_content
      temp_map_extract <- str_extract_all(temp_map, boundary("character"))
      temp_map_extract[[i]][x_ids[[i]][j]] <- "#"
      
      start_loc <- find_guard_details(temp_map,direction,dist_pos)
      temp_map_extract[[start_loc$y_loc]][start_loc$x_loc] <- start_loc$direction
      
      for (k in 1:length(temp_map_extract)){
        temp_map[[k]] <- paste(temp_map_extract[[k]], collapse="")
      }
    
    count <- count + 1
    alt_input_maps[[count]] <- temp_map
      
    }
     
  }  
}


start.time <- Sys.time()
obstruction <- vector(mode = "list", length = 4967)
inner_count <- 0
off_map_flag <- FALSE
count_lim <- 300

for (i in 1:4967){
  input_map_ob <- alt_input_maps[[i]]
  #inner_count <- 0
  #input_map_ob < file_content
  while (isFALSE(off_map_flag)){
    guard_details <- find_guard_details(input_map_ob, direction, dist_pos)
    
    if (guard_details$direction == "^"){
      up <- motion_up(guard_details,input_map_ob,direction)
      
      input_map_ob <- up$input_map
      dist_pos <- up$dist_pos
      off_map_flag <- up$flag
      inner_count <- inner_count + 1
      #print(paste("Inner Count",inner_count))
      
    } else if (guard_details$direction == "v"){
      down <- motion_down(guard_details,input_map_ob,direction)
      
      input_map_ob <- down$input_map
      dist_pos <- down$dist_pos
      off_map_flag <- down$flag
      inner_count <- inner_count + 1
      #print(paste("Inner Count",inner_count))
      
    } else if (guard_details$direction == "<"){
      left <- motion_left(guard_details,input_map_ob,directions)
      
      input_map_ob <- left$input_map
      dist_pos <- left$dist_pos
      off_map_flag <- left$flag
      inner_count <- inner_count + 1
      #print(paste("Inner Count",inner_count))
      
    } else if (guard_details$direction == ">"){
      right <- motion_right(guard_details,input_map_ob,direction)
      
      input_map_ob <- right$input_map
      dist_pos <- right$dist_pos
      off_map_flag <- right$flag
      inner_count <- inner_count + 1
      #print(paste("Inner Count",inner_count))
    }
    
    
    #print(paste("Count",inner_count))
    
    if (inner_count > count_lim){
       break
     }
  }
  
     
  if (inner_count > count_lim){
    obstruction[[i]] <- "Looped"
    inner_count <- 0
    off_map_flag <- FALSE
  } else if (!isFALSE(off_map_flag)){
    obstruction[[i]] <- "Not"
    inner_count <- 0
    off_map_flag <- FALSE
  }
  
  print(paste("Alt Input",i))
  print(paste("Result",obstruction[[i]]))
}

find_looped <- str_match_all(obstruction,"Looped")
looped_ids <- which(lengths(find_looped)!=0)

pt2_solution <- length(looped_ids)

end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken


```
